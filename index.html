<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Document</title>
</head>
<body>

<script type="text/javascript">

function domainName() {
  const result = [];
  var chars = new Array(26);
  for(var i = 0; i < 26; ++i) {
    chars[i] = String.fromCharCode(i + 97);
  }
  for(var i = 0; i < 26; ++i){
    for(var j = 0; j < 26; ++j){
      result.push(chars[i]+chars[j]);
      // for(var k = 0; k < 26; ++k){
        // result.push(chars[i]+chars[j]+chars[k]);
      // }
    }
  }
  return result;
}
console.log(domainName())

// ①自动执行函数，②三个状态，③then
// splice 删除并添加元素，改变原数组
// slice 返回一个新的数组对象 (begin, end)，不会更改现有数组
// concat 合并数组，不会更改现有数组，而是返回一个新数组
// copyWithin 浅复制数组的一部分到同一数组中的另一个位置，不会改变原数组的长度
/**
 * Element virdual-dom 对象定义
 * @param {String} tagName - dom 元素名称
 * @param {Object} props - dom 属性
 * @param {Array<Element|String>} - 子节点
 */
function Element(tagName, props, children) {
    this.tagName = tagName
    this.props = props
    this.children = children
    // dom 元素的 key 值，用作唯一标识符
    if(props.key){
       this.key = props.key
    }
    var count = 0
    children.forEach(function (child, i) {
      if (child instanceof Element) {
          count += child.count
      } else {
          children[i] = '' + child
      }
      count++
    })
    // 子元素个数
    this.count = count
}
function el(tagName, props, children){
 return new Element(tagName, props, children);
}

Element.prototype.render = function (){
  const el = document.createElement(this.tagName);
  const props = this.props;
  for (let propName in props) {
    if (props.hasOwnProperty(propName)) {
      const propValue = props[propName]
      el.setAttribute(propName, propValue)
    }
  }
  const children = this.children || [];
  children.forEach(function(child) {
    var childEl = (child instanceof Element)
                  ? child.render()
                  : document.createTextNode(child);
    el.appendChild(childEl)
  })
  return el;
}
// diff start
function diff(oldTree, newTree) {
    var index = 0;
    var patches = {};
    dfsWalk(oldTree, newTree, index, patches);
    return patches
}
const patch = {
  REPLACE: 0,
  REORDER: 1,
  PROPS: 2,
  TEXT: 3
}
function dfsWalk(oldNode, newNode, index, patches) {
  var currentPatch = [];
  if(typeof (oldNode) === 'string' && typeof (newNode) === "string") {
    // 文本内容改变
    if (newNode !== oldNode) {
      currentPatch.push({ type: patch.TEXT, content: newNode })
    }
  } else if(newNode != null && oldNode.tagName === newNode.tagName && oldNode.key === newNode.key) {
    // 节点相同，比较属性
    var propsPatches = diffProps(oldNode, newNode);
    if (propsPatches) {
      currentPatch.push({ type: patch.PROPS, props: propsPatches })
    }
    // 比较子节点，如果子节点有'ignore'属性，则不需要比较
    if (!isIgnoreChildren(newNode)) {
      diffChildren(
        oldNode.children,
        newNode.children,
        index,
        patches,
        currentPatch
      )
    }
  } else if(newNode !== null){
    // 新节点和旧节点不同，用 replace 替换
    currentPatch.push({ type: patch.REPLACE, node: newNode })
  }

  if (currentPatch.length) {
    patches[index] = currentPatch
  }
}
function diffProps(oldNode, newNode) {
  var count = 0
  var oldProps = oldNode.props;
  var newProps = newNode.props;
  var propsPatches = {}

  for (var key in oldProps) {
    if (oldProps[key] !== newProps[key]) {
      count++
      propsPatches[key] = newProps[key];
    }
  }

  for (var key in newProps) {
    if (!oldProps.hasOwnProperty(key)) {
      count++
      propsPatches[key] = newProps[key];
    }
  }
  // 没有属性改变
  if (count === 0) {
    return null
  }
  return propsPatches;
}
function isIgnoreChildren(node) {
  return (node.props && node.props.hasOwnProperty('ignore'))
}
// 遍历子节点
function diffChildren(oldChildren, newChildren, index, patches, currentPatch) {

}

// diff end




var ul1 = el('div',{id:'virtual-dom'},[
  el('p',{},['Virtual DOM']),
  el('ul', { id: 'list' }, [
	el('li', { class: 'item' }, ['Item 1']),
	el('li', { class: 'item' }, ['Item 2']),
	el('li', { class: 'item' }, ['Item 3'])
  ]),
  el('div',{},['Hello World'])
])
var ul2 = el('div',{id:'virtual-dom'},[
  el('p',{},['Virtual DOM']),
  el('ul', { id: 'list' }, [
	el('li', { class: 'item' }, ['Item 21']),
	el('li', { class: 'item' }, ['Item 23'])
  ]),
  el('p',{},['Hello World'])
])
console.log('ul1:', ul1);
console.log('ul2:', ul2);
var patches = diff(ul1,ul2);
console.log('patches:', patches);
</script>
</script>
</body>
</html>
